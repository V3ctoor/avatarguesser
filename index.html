<!DOCTYPE html>
<html>
<head>
    <title>Random Image Viewer</title>

    <style>
        #image-container {
            width: 100%;
            height: 500px;
            border: 1px solid #000;
            margin: 0 auto;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }

        #filename {
            text-align: center;
            margin: 10px auto;
        }

        #guess-input {
            display: block;
            width: 200px;
            margin: 20px auto;
        }

        #score {
            text-align: center;
            margin: 10px auto;
            font-size: 1.5em;
        }

        #guess-button {
            display: block;
            margin: 0 auto;
        }

        #try-again-button {
            display: none;
            margin: 0 auto;
        }

        #feedback {
            text-align: center;
            margin: 20px auto;
            font-size: 1.5em;
        }

        #guess-button, #try-again-button {
            padding: 20px 40px;
            font-size: 1.5em;
        }

        #guess-input {
            padding: 10px;
            font-size: 1.5em;
        }
    </style>
</head>
<body>
    <div id="image-container"></div>
    <div id="filename"></div>
    <input id="guess-input" list="episode-names" placeholder="Guess the episode name...">
    <button id="guess-button" onclick="checkGuess(document.getElementById('guess-input').value)">Guess</button>
    <button id="try-again-button" onclick="resetGame()">Try Again</button>
    <datalist id="episode-names">
        <!-- JavaScript will populate this with the episode names -->
    </datalist>
    <div id="score">Score: 0</div>
    <div id="feedback"></div>

    <script>
        let episodes = {};
        let score = 0;
        let currentEpisode = "";

        // Fetch the episode data from the JSON file
        fetch('episodes.json')
        .then(response => response.json())
        .then(data => {
            episodes = data;

            // Populate the datalist with the episode names
            let datalist = document.getElementById('episode-names');
            for (let episode in episodes) {
                let option = document.createElement('option');
                option.value = episode;
                datalist.appendChild(option);
            }

            showRandomImage(); // show a random image immediately when the data is loaded
        });

        function showRandomImage() {
            let episodeNames = Object.keys(episodes);
            let randomEpisodeIndex = Math.floor(Math.random() * episodeNames.length);
            currentEpisode = episodeNames[randomEpisodeIndex];
            
            let images = episodes[currentEpisode];
            let randomImageIndex = Math.floor(Math.random() * images.length);
            let randomImage = images[randomImageIndex];
            let encodedImage = encodeURI('randomframes/' + randomImage);

            document.getElementById('image-container').style.backgroundImage = 'url("' + encodedImage + '")';
            document.getElementById('guess-input').value = "";
            document.getElementById('guess-input').style.display = 'block';
            document.getElementById('guess-button').style.display = 'block';
            document.getElementById('try-again-button').style.display = 'none';
            document.getElementById('feedback').innerText = '';
        }

        function checkGuess(guess) {
            if (Object.keys(episodes).includes(guess)) { // Check if the guess is in the list of episode names
                if (guess === currentEpisode) {
                    score++;
                    showRandomImage();
                } else {
                    document.getElementById('guess-input').style.display = 'none';
                    document.getElementById('guess-button').style.display = 'none';
                    document.getElementById('try-again-button').style.display = 'block';
                    document.getElementById('feedback').innerText = "Good try, but no. It was " + currentEpisode + ".";
                }
                document.getElementById('score').innerText = "Score: " + score;
            } else {
                alert("Please select an episode from the list.");
            }
        }

        function resetGame() {
            score = 0; // reset the score when "Try Again" is clicked
            showRandomImage();
            document.getElementById('score').innerText = "Score: " + score;
        }
    </script>
</body>
</html>